{
	"version":"1.0",
    "comment":"海航常旅客注册_24mail版",
	"commRules":{
		"comm_error":[			
		]
	},
	
 "actions":{
	
  "prepare":[
	{
		"HttpMethod":"Get",
		"url":"http://24mail.chacuo.net/",
		"referer":"http://24mail.chacuo.net/",
		"waitTime":"10",
		"params":[
		],
		"result_parserules":[
				{ "command":"stream_to_string", "in":"_receiveData", "out":"page" },
				{ "command":"stream_to_html", "in":"_receiveData", "out":"jschl_vc", "xpath":"//input[@name=\"jschl_vc\"]/@value", "type":"text" },
				{ "command":"stream_to_html", "in":"_receiveData", "out":"tmpNode", "xpath":"//form[@id=\"challenge-form\"]//input[@name=\"jschl_vc\"]", "type":"element" },
				{ "command":"html_to_var", "in":"tmpNode", "out":"jschl_vc", "path":"@value" },
				{ "command":"stream_to_html", "in":"_receiveData", "out":"tmpNode", "xpath":"//form[@id=\"challenge-form\"]//input[@name=\"pass\"]", "type":"element" },
				{ "command":"html_to_var", "in":"tmpNode", "out":"pass", "path":"@value" },
				{ "command":"stream_to_html", "in":"_receiveData", "out":"tmpNode", "xpath":"//form[@id=\"challenge-form\"]//input[@name=\"jschl-answer\"]", "type":"element" },
				{ "command":"html_to_var", "in":"tmpNode", "out":"jschl-answer", "path":"@value" }
			]
		},
		{
			"HttpMethod":"Get",
			"url":"http://24mail.chacuo.net/cdn-cgi/l/chk_jschl",
			"referer":"http://24mail.chacuo.net/",
			"waitTime":"10",
			"params":[
					{ "httpKey":"jschl_vc","localKey":"jschl_vc"},
					{ "httpKey":"pass","localKey":"pass"}
				],
			"result_parserules":[
					{ "command":"stream_to_string", "in":"_receiveData", "out":"page" }
			]
		},
		{
			"HttpMethod":"Post",
			"url":"http://zhiji.rsscc.com/common-helper/9c_web/get_random_user.json",
			"params":[
				{ "httpKey":"page","localKey":"page"}
			],
			"result_parserules":[
			   	{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
            	{ "command":"var_to_var", "in":"tmpJson(username)", "out":"username" },
            	{ "command":"string_replace", "in":"username", "out":"username", "old":"@chacuo.net", "new":"" },
            	{ "command":"array_to_string", "in":["username", "@@027168.com"], "out":"email", "join":"" },
				{ "command":"var_to_var", "out":"tmpJson" },
				{ "command":"var_to_var", "out":"page" }
			]
		},
		{
			"HttpMethod":"Get",
			"url":"http://221.235.53.164:7000/common-helper/get_random_user.json",
			"params":[
			],
			"result_parserules":[
			   	{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
            	{ "command":"var_to_var", "in":"tmpJson(password)", "out":"password" },
            	{ "command":"var_to_var", "in":"tmpJson(name)", "out":"name" },
            	{ "command":"var_to_var", "in":"tmpJson(firstname)", "out":"firstName" },
            	{ "command":"var_to_var", "in":"tmpJson(lastname)", "out":"lastName" },
            	{ "command":"var_to_var", "in":"tmpJson(firstnamepy)", "out":"firstNamePy" },
            	{ "command":"var_to_var", "in":"tmpJson(lastnamepy)", "out":"lastNamePy" },
            	{ "command":"var_to_var", "in":"tmpJson(idcard)", "out":"idcard" },
            	{ "command":"var_to_var", "in":"tmpJson(birthday)", "out":"birthday" },
            	{ "command":"string_replace", "in":"birthday", "out":"birthday", "old":"-", "new":"" },
            	{ "command":"var_to_var", "in":"tmpJson(phone)", "out":"mobile" },
            	{ "command":"var_to_var", "in":"tmpJson(gender)", "out":"gender" },
				{ "command":"var_to_var", "out":"tmpJson" }
			]
		}
	],
	
	"add_email":[
		{
			"HttpMethod":"Get",
			"url":"http://ffp.hnair.com/FFPClub/member/register",
			"params":[
			],
			"result_parserules":[
				]
		},
		{
        	"comment":"获取验证码",
            "HttpMethod":"Get",
            "url":"http://ffp.hnair.com/FFPClub/imgcode.do",
            "referer":"http://ffp.hnair.com/FFPClub/member/register",
            "waitDesc":"处理中...",
			"result_parserules":[
				{ "command":"base64_encode", "in":"_receiveData", "out":"base64String" },
				{ "command":"var_to_var", "out":"_receiveData" }
			]
        },
        {
            "comment":"识别验证码",
            "HttpMethod":"Post",
            "url":"http://zhiji.rsscc.com/decaptcha2/decaptcha",
            "waitDesc":"处理中...",
            "params":[
				{ "httpKey":"base64String", "localKey":"base64String" },
				{ "httpKey":"type", "default":"hu.ffpcard.v2" }
			],
			"result_parserules":[
				{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
				{ "command":"var_to_var", "in":"tmpJson(captcha)", "out":"verifyCode" },
				{ "command":"if", "if":["verifyCode", "==", "@4", "length"], "rules":[
				], "else_rules":[
				    { "command":"var_to_var", "in":"@获取验证码失败", "out":"resultError" }
				]},
				{ "command":"var_to_var", "out":"tmpJson" },
				{ "command":"var_to_var", "out":"base64String" },
				{ "command":"var_to_var", "out":"action" }
			]
        },
		{
			"HttpMethod":"Post",
			"url":"http://ffp.hnair.com/FFPClub/emailValidCode/send?lang=cn&r=0.9427779052873868",
			"referer":"http://ffp.hnair.com/FFPClub/member/register",
			"params":[
				{ "httpKey":"emailNo", "localKey":"email" },
				{ "httpKey":"vc", "localKey":"verifyCode" }
			],
			"result_parserules":[
				{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
				{ "command":"var_to_var", "in":"tmpJson(state)", "out":"state" },
				{ "command":"var_to_var", "in":"tmpJson(msg)", "out":"msg" },
				{ "command":"if", "if":["state", "=", "@1"], "rules":[
				], "else_rules":[
				    { "command":"var_to_var", "in":"msg", "out":"resultError" }
				]},
				{ "command":"var_to_var", "out":"tmpJson" },
				{ "command":"var_to_var", "out":"state" },
				{ "command":"var_to_var", "out":"msg" }
			]
		}
	],
		
	"get_verify_code":[
		{
			"HttpMethod":"Post",
			"url":"http://24mail.chacuo.net/",
			"referer":"http://24mail.chacuo.net/",
			"ContentType":"application/x-www-form-urlencoded; charset=UTF-8",
			"params":[
				{ "httpKey":"data", "localKey":"username" },
				{ "httpKey":"type", "default":"set" },
				{ "httpKey":"arg", "default":"d=chacuo.net_f=" }
			],
			"result_parserules":[
			]
		},
	   {
			"HttpMethod":"Post",
			"url":"http://24mail.chacuo.net/",
			"referer":"http://24mail.chacuo.net/",
			"ContentType":"application/x-www-form-urlencoded; charset=UTF-8",
			"params":[
				{ "httpKey":"data", "localKey":"username" },
				{ "httpKey":"type", "default":"refresh" },
				{ "httpKey":"arg", "default":"" }
			],
			"result_parserules":[
				{ "command":"stream_to_string", "in":"_receiveData", "out":"dataJson" },
				{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
				{ "command":"json_get_array", "in":"tmpJson", "out":"tmpArray", "item":"list" },
				{ "command":"regular_text", "in":"dataJson", "out":"hnairFlag", "regular":"ffpweb@hnair.com" },
				{ "command":"if", "if":["hnairFlag", "=", "@0", "length"], "rules":[
				   		{ "command":"var_to_var", "in":"@找不到验证码", "out":"resultError" }
				]}
			]
		},
		{
			"HttpMethod":"Post",
			"url":"http://zhiji.rsscc.com/kn_web/ticket/parse_24mail_info.json",
			"params":[
				{ "httpKey":"dataJson", "localKey":"dataJson"},
				{ "httpKey":"keyword", "default":"ffpweb@hnair.com"}
			],
			"result_parserules":[
			   	{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
			   	{ "command":"var_to_var", "in":"tmpJson(resultError)", "out":"resultError" },
            	{ "command":"var_to_var", "in":"tmpJson(arg)", "out":"arg" },
				{ "command":"if", "if":["arg", "=", "@0", "length"], "rules":[
					{ "command":"var_to_var", "in":"@找不到验证码", "out":"resultError" }
		    	 ]},
				{ "command":"var_to_var", "out":"dataJson" }
			]
		},
		{
			"HttpMethod":"Post",
			"url":"http://24mail.chacuo.net/",
			"referer":"http://24mail.chacuo.net/",
			"params":[
				{ "httpKey":"data", "localKey":"username" },
				{ "httpKey":"type", "default":"mailinfo" },
				{ "httpKey":"arg", "localKey":"arg", "default":"" }
	
			],
			"result_parserules":[
				{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
				{ "command":"regular_text", "in":"tmpString", "out":"emailVerifyCode", "regular":"(?<=uff1a).*?(?=uff0c)" },
				{ "command":"string_replace", "in":"emailVerifyCode", "out":"emailVerifyCode", "old":"\\", "new":"" },
				{ "command":"if", "if":["emailVerifyCode", "=", "@0", "length"], "rules":[
				   		{ "command":"var_to_var", "in":"@找不到验证码", "out":"resultError" }
			    ]},
				{ "command":"var_to_var", "out":"tmpString" }
			]
		},
		{
			"HttpMethod":"Post",
			"url":"http://ffp.hnair.com/FFPClub/emailValidCode/check?r=0.7960585145660131",
			"referer":"http://ffp.hnair.com/FFPClub/member/register",
			"input_parserules":[
				{ "command":"cookie_to_var", "in":"JSESSIONID", "domain":"ffp.hnair.com", "path":"/FFPClub/", "out":"JSESSIONID" },
				{ "command":"array_to_string", "in":["@JSESSIONID=", "JSESSIONID", "cookie"], "out":"cookie", "join":"" },
				{ "command":"array_to_string", "in":["@s_fid=", "@7E5266141BA4B4F5-162900F06270202B;", "cookie"], "out":"cookie", "join":"" },
				{ "command":"array_to_string", "in":["@OZ_1U_1979=", "@vid=v5ed23eb58689f.0&ctime=1442398037&ltime=1442398030;", "cookie"], "out":"cookie", "join":"" },
				{ "command":"array_to_string", "in":["@_gscu_1072803018=", "@41692264yivw8521;", "cookie"], "out":"cookie", "join":"" },
				{ "command":"array_to_string", "in":["@_gscbrs_1072803018=", "@1;", "cookie"], "out":"cookie", "join":"" },
				{ "command":"array_to_string", "in":["@__clickidc=", "@145454944212938594;", "cookie"], "out":"cookie", "join":"" },
				{ "command":"array_to_string", "in":["@4_vq=", "@4;", "cookie"], "out":"cookie", "join":"" }
			],
			"params":[
				{ "httpKey":"inputCode", "localKey":"emailVerifyCode" }
			],
			"result_parserules":[
				{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
				{ "command":"var_to_var", "in":"tmpJson(state)", "out":"state" },
				{ "command":"var_to_var", "in":"tmpJson(msg)", "out":"msg" },
				{ "command":"if", "if":["state", "=", "@1"], "rules":[
				], "else_rules":[
				    { "command":"var_to_var", "in":"msg", "out":"resultError" }
				]},
				{ "command":"var_to_var", "out":"tmpJson" },
				{ "command":"var_to_var", "out":"state" },
				{ "command":"var_to_var", "out":"msg" }
			]
		}
	],
		
	"register":[
		{
			"HttpMethod":"Post",
			"url":"http://127.0.0.1:9040/auto-register/ffpcard/hu/get_post_data.json",
			"params":[
				{ "httpKey":"contextString", "localKey":"contextString" }
			],
			"result_parserules":[
			   	{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
            	{ "command":"var_to_var", "in":"tmpJson(resultError)", "out":"resultError" },
            	{ "command":"var_to_var", "in":"tmpJson(postData)", "out":"postData" },
				{ "command":"var_to_var", "out":"contextString" },
				{ "command":"var_to_var", "out":"tmpJson" }
			]
		},
		{
			"HttpMethod":"Post",
			"url":"http://ffp.hnair.com/FFPClub/member/register",
			"referer":"http://ffp.hnair.com/FFPClub/member/register",
			"ContentType":"application/x-www-form-urlencoded",
			"timeout":"180",
			"headers":[
            	{ "httpKey":"Cookie", "localKey":"cookie" }
            ],
			"params":[
				{ "_data":"postData" }
			],
			"result_parserules":[
				{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
				{ "command":"regular_text", "in":"tmpString", "out":"registerSuccessTip", "regular":"注册成功"},
				{ "command":"regular_text", "in":"tmpString", "out":"duplicateTip", "regular":"主要信息重复"},
				{ "command":"if", "if":["registerSuccessTip", ">", "@0", "length"], "rules":[
					{ "command":"var_to_var", "in":"@register", "out":"action" },
					{ "command":"var_to_var", "in":"@注册成功", "out":"successTip" }
				], "else_rules":[
					{ "command":"var_to_var", "in":"@注册失败", "out":"resultError" }
				]},
				{ "command":"if", "if":["duplicateTip", ">", "@0", "length"], "rules":[
					{ "command":"var_to_var", "in":"@主要信息重复", "out":"resultError" }
				]},
				{ "command":"var_to_var", "out":"tmpString" }
			]
		},
		{
			"HttpMethod":"Post",
			"url":"http://ffp.hnair.com/FFPClub/calculator/loadUserLogin",
			"referer":"http://ffp.hnair.com/FFPClub/member/registerDone?lang=cn",
			"ContentType":"application/x-www-form-urlencoded",
			"timeout":"180",
			"headers":[
            	{ "httpKey":"Cookie", "localKey":"cookie" }
            ],
			"params":[
			],
			"result_parserules":[
				{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
				{ "command":"regular_text", "in":"tmpString", "out":"ffpcard", "regular":"(?<=CID).*?(?=,)" },
				{ "command":"regular_text", "in":"ffpcard", "out":"ffpcard", "regular":"\\d+" },
				{ "command":"if", "if":["ffpcard", ">", "@0", "length"], "rules":[
					{ "command":"var_to_var", "in":"@register", "out":"action" },
					{ "command":"var_to_var", "in":"@注册成功", "out":"successTip" },
					{ "command":"var_to_var", "out":"resultError" }
				], "else_rules":[
					
				]},
				{ "command":"var_to_var", "out":"tmpString" }
			]
		}
	  ]
	},
	
	"settings":{
		"exclude_from_local_dict":[
			"_receiveData",
			"page",
			"content",
			"verifyCodeImage"
		],
		
		"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36 OPR/28.0.1750.51"
    }
}