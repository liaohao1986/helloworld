{
	"version":"1.0",
    "comment":"海航常旅客注册_maopao版",
	"commRules":{
		"comm_error":[			
		]
	},
	
 "actions":{
	
	"prepare":[
		{
			"HttpMethod":"Get",
			"url":"http://221.235.53.164:7000/common-helper/get_random_user.json",
			"params":[
			],
			"result_parserules":[
			   	{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
            	{ "command":"var_to_var", "in":"tmpJson(username)", "out":"username" },
            	{ "command":"var_to_var", "in":"tmpJson(password)", "out":"password" },
            	{ "command":"var_to_var", "in":"tmpJson(name)", "out":"name" },
            	{ "command":"var_to_var", "in":"tmpJson(firstname)", "out":"firstName" },
            	{ "command":"var_to_var", "in":"tmpJson(lastname)", "out":"lastName" },
            	{ "command":"var_to_var", "in":"tmpJson(firstnamepy)", "out":"firstNamePy" },
            	{ "command":"var_to_var", "in":"tmpJson(lastnamepy)", "out":"lastNamePy" },
            	{ "command":"var_to_var", "in":"tmpJson(idcard)", "out":"idcard" },
            	{ "command":"var_to_var", "in":"tmpJson(birthday)", "out":"birthday" },
            	{ "command":"string_replace", "in":"birthday", "out":"birthday", "old":"-", "new":"" },
            	{ "command":"var_to_var", "in":"tmpJson(phone)", "out":"mobile" },
            	{ "command":"var_to_var", "in":"tmpJson(gender)", "out":"gender" },
            	{ "command":"var_to_var", "in":"@123456", "out":"ffpcardPassword" },
				{ "command":"var_to_var", "out":"tmpJson" }
			]
		}
	],
	
	"add_email":[
		{
			"HttpMethod":"Post",
			"url":"http://103.37.164.146:9080/qmailadmin/index.cgi",
			"referer":"http://103.37.164.146:9080/qmailadmin/",
			"params":[
				{ "httpKey":"username", "default":"postmaster" },
				{ "httpKey":"domain", "default":"maopao.com" },
				{ "httpKey":"password", "default":"openet" },
				{ "httpKey":"returnhttp", "default":"" },
				{ "httpKey":"returntext", "default":"" }
			],
			"result_parserules":[
				{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
				{ "command":"regular_text", "in":"tmpString", "out":"timestamp", "regular":"(?<=time=).*?(?=\">)" },
				{ "command":"var_to_var", "out":"tmpString" }
			]
		},
		{
			"HttpMethod":"Get",
			"url":"http://103.37.164.146:9080/qmailadmin/index.cgi/com/adduser",
			"referer":"http://103.37.164.146:9080/qmailadmin/index.cgi",
			"params":[
				{ "httpKey":"user", "default":"postmaster" },
				{ "httpKey":"dom", "default":"maopao.com" },
				{ "httpKey":"time", "localKey":"timestamp" }
			],
			"result_parserules":[
				{ "command":"stream_gbk_to_utf8", "in":"_receiveData", "out":"_receiveData" },
				{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
				{ "command":"regular_text", "in":"tmpString", "out":"isLogined", "regular":"请稍后再登陆一次"},
				{ "command":"if", "if":["isLogined", ">", "@0", "length"], "rules":[
					{ "command":"var_to_var", "in":"@同时只能有一个人作为postmaster(邮箱管理员)登陆。已经有别人登陆进入。请稍后再登陆一次。", "out":"resultError" }
			     ]},
			    { "command":"var_to_var", "out":"isLogined" },
				{ "command":"var_to_var", "out":"tmpString" }
			]
		},
		{
			"HttpMethod":"Post",
			"url":"_url",
			"referer":"http://103.37.164.146:9080/qmailadmin/index.cgi/com/adduser",
			"input_parserules":[
				{ "command":"array_to_string", "in":["@http://103.37.164.146:9080/qmailadmin/index.cgi/com/addusernow?user=postmaster&dom=maopao.com&time=", "timestamp"], "out":"_url", "join":"" }
			],
			"params":[
				{ "httpKey":"newu", "localKey":"username" },
				{ "httpKey":"quota", "default":"1" },
				{ "httpKey":"password1", "default":"huoli123" },
				{ "httpKey":"password2", "default":"huoli123" },
				{ "httpKey":"gecos", "localKey":"username" }
			],
			"result_parserules":[
				{ "command":"stream_gbk_to_utf8", "in":"_receiveData", "out":"_receiveData" },
				{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
				{ "command":"regular_text", "in":"tmpString", "out":"isUsed", "regular":"名字已被使用"},
				{ "command":"if", "if":["isUsed", ">", "@0", "length"], "rules":[
					{ "command":"var_to_var", "in":"@该名字已被使用，请重新替换", "out":"resultError" }
			     ]},
				{ "command":"regular_text", "in":"tmpString", "out":"success", "regular":"添加成功"},
				{ "command":"if", "if":["success", ">", "@0", "length"], "rules":[
					{ "command":"array_to_string", "in":["username", "@@maopao.com"], "out":"email", "join":"" },
					{ "command":"var_to_var", "in":"@add_success", "out":"action" }
				]},
				{ "command":"var_to_var", "out":"_url" },
				{ "command":"var_to_var", "out":"isUsed" },
				{ "command":"var_to_var", "out":"success" },
				{ "command":"var_to_var", "out":"tmpString" }
			]
		},
		{
			"HttpMethod":"Get",
			"url":"http://ffp.hnair.com/FFPClub/member/register",
			"params":[
			],
			"result_parserules":[
				]
		},
		{
        	"comment":"获取验证码",
            "HttpMethod":"Get",
            "url":"http://ffp.hnair.com/FFPClub/imgcode.do",
            "referer":"http://ffp.hnair.com/FFPClub/member/register",
            "waitDesc":"处理中...",
			"result_parserules":[
				{ "command":"base64_encode", "in":"_receiveData", "out":"base64String" },
				{ "command":"var_to_var", "out":"_receiveData" }
			]
        },
        {
            "comment":"识别验证码",
            "HttpMethod":"Post",
            "url":"http://zhiji.rsscc.com/decaptcha2/decaptcha",
            "waitDesc":"处理中...",
            "params":[
				{ "httpKey":"base64String", "localKey":"base64String" },
				{ "httpKey":"type", "default":"hu.ffpcard.v2" }
			],
			"result_parserules":[
				{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
				{ "command":"var_to_var", "in":"tmpJson(captcha)", "out":"verifyCode" },
				{ "command":"if", "if":["verifyCode", "==", "@4", "length"], "rules":[
				], "else_rules":[
				    { "command":"var_to_var", "in":"@获取验证码失败", "out":"resultError" }
				]},
				{ "command":"var_to_var", "out":"tmpJson" },
				{ "command":"var_to_var", "out":"base64String" },
				{ "command":"var_to_var", "out":"action" }
			]
        },
		{
			"HttpMethod":"Post",
			"url":"http://ffp.hnair.com/FFPClub/emailValidCode/send?lang=cn&r=0.9427779052873868",
			"referer":"http://ffp.hnair.com/FFPClub/member/register",
			"params":[
				{ "httpKey":"emailNo", "localKey":"email" },
				{ "httpKey":"vc", "localKey":"verifyCode" }
			],
			"result_parserules":[
				{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
				{ "command":"var_to_var", "in":"tmpJson(state)", "out":"state" },
				{ "command":"var_to_var", "in":"tmpJson(msg)", "out":"msg" },
				{ "command":"if", "if":["state", "=", "@1"], "rules":[
				], "else_rules":[
				    { "command":"var_to_var", "in":"msg", "out":"resultError" }
				]},
				{ "command":"var_to_var", "out":"tmpJson" },
				{ "command":"var_to_var", "out":"state" },
				{ "command":"var_to_var", "out":"msg" }
			]
		}
	],
		
	"get_verify_code":[
		{
			"HttpMethod":"Post",
			"url":"http://103.37.164.146:9080/webmail/src/redirect.php",
			"referer":"http://103.37.164.146:9080/webmail/src/login.php",
			"ContentType":"application/x-www-form-urlencoded",
			"params":[
				{ "httpKey":"login_username", "localKey":"email" },
				{ "httpKey":"secretkey", "default":"huoli123" },
				{ "httpKey":"js_autodetect_results", "default":"1" },
				{ "httpKey":"just_logged_in", "default":"1" }
			],
			"result_parserules":[
			]
		},
		{
			"HttpMethod":"Get",
			"url":"http://103.37.164.146:9080/webmail/src/right_main.php",
			"referer":"http://103.37.164.146:9080/webmail/src/webmail.php",
			"params":[
			],
			"result_parserules":[
				{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
				{ "command":"regular_text", "in":"tmpString", "out":"passed_id", "regular":"(?<=INBOX&amp;passed_id=).*?(?=&amp;startMessage=1\" >&#35831;&#30830;&#35748;&#37038;&#20214;&#22320;&#22336;)" },
				{ "command":"if", "if":["passed_id", "=", "@0", "length"], "rules":[
					{ "command":"var_to_var", "in":"@找不到验证码邮件", "out":"resultError" }
		    	 ]},
				{ "command":"var_to_var", "out":"tmpString" }
			]
		},
		{
			"HttpMethod":"Get",
			"url":"http://103.37.164.146:9080/webmail/src/read_body.php?mailbox=INBOX&passed_id=1&startMessage=1",
			"params":[
			],
			"result_parserules":[
				{ "command":"stream_gbk_to_utf8", "in":"_receiveData", "out":"_receiveData" },
				{ "command":"stream_to_string", "in":"_receiveData", "out":"page" },
				{ "command":"regular_text", "in":"page", "out":"emailVerifyCode", "regular":"(?<=验证码为：).*?(?=，本次验证码)" },
				{ "command":"var_to_var", "in":"@235678", "out":"emailVerifyCode" },
				{ "command":"if", "if":["emailVerifyCode", "=", "@0", "length"], "rules":[
				   		{ "command":"var_to_var", "in":"@找不到验证码", "out":"resultError" }
				]}
			]
		}
	],
		
	"register":[
		{
			"HttpMethod":"Post",
			"url":"http://127.0.0.1:9040/auto-register/ffpcard/hu/get_post_data.json",
			"params":[
				{ "httpKey":"contextString", "localKey":"contextString" }
			],
			"result_parserules":[
			   	{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
            	{ "command":"var_to_var", "in":"tmpJson(resultError)", "out":"resultError" },
            	{ "command":"var_to_var", "in":"tmpJson(postData)", "out":"postData" },
				{ "command":"var_to_var", "out":"contextString" },
				{ "command":"var_to_var", "out":"tmpJson" }
			]
		},
		{
			"HttpMethod":"Post",
			"url":"http://ffp.hnair.com/FFPClub/member/register",
			"referer":"http://ffp.hnair.com/FFPClub/member/register",
			"ContentType":"application/x-www-form-urlencoded",
			"timeout":"180",
			"headers":[
            	{ "httpKey":"Cookie", "localKey":"cookie" }
            ],
			"params":[
				{ "_data":"postData" }
			],
			"result_parserules":[
				{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
				{ "command":"regular_text", "in":"tmpString", "out":"registerSuccessTip", "regular":"注册成功"},
				{ "command":"regular_text", "in":"tmpString", "out":"duplicateTip", "regular":"主要信息重复"},
				{ "command":"if", "if":["registerSuccessTip", ">", "@0", "length"], "rules":[
					{ "command":"var_to_var", "in":"@register", "out":"action" },
					{ "command":"var_to_var", "in":"@注册成功", "out":"successTip" }
				], "else_rules":[
					{ "command":"var_to_var", "in":"@注册失败", "out":"resultError" }
				]},
				{ "command":"if", "if":["duplicateTip", ">", "@0", "length"], "rules":[
					{ "command":"var_to_var", "in":"@主要信息重复", "out":"resultError" }
				]},
				{ "command":"var_to_var", "out":"tmpString" }
			]
		},
		{
			"HttpMethod":"Post",
			"url":"http://ffp.hnair.com/FFPClub/calculator/loadUserLogin",
			"referer":"http://ffp.hnair.com/FFPClub/member/registerDone?lang=cn",
			"ContentType":"application/x-www-form-urlencoded",
			"timeout":"180",
			"headers":[
            	{ "httpKey":"Cookie", "localKey":"cookie" }
            ],
			"params":[
			],
			"result_parserules":[
				{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
				{ "command":"regular_text", "in":"tmpString", "out":"ffpcard", "regular":"(?<=CID).*?(?=,)" },
				{ "command":"regular_text", "in":"ffpcard", "out":"ffpcard", "regular":"\\d+" },
				{ "command":"if", "if":["ffpcard", ">", "@0", "length"], "rules":[
					{ "command":"var_to_var", "in":"@register", "out":"action" },
					{ "command":"var_to_var", "in":"@注册成功", "out":"successTip" }
				], "else_rules":[
					{ "command":"var_to_var", "in":"@注册失败", "out":"resultError" }
				]},
				{ "command":"var_to_var", "out":"tmpString" }
			]
		}
	  ]
	},
	
	"settings":{
		"exclude_from_local_dict":[
			"_receiveData",
			"page",
			"content",
			"verifyCodeImage"
		],
		
		"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36 OPR/28.0.1750.51"
    }
}