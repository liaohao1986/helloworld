{
	"version":"1.0",
    "comment":"maopao邮箱注册春秋账号",
	"commRules":{
		"comm_error":[			
		]
	},
	
 "actions":{
	
	"prepare":[
		{
			"HttpMethod":"Get",
			"url":"http://221.235.53.164:7000/common-helper/get_random_user.json",
			"params":[
			],
			"result_parserules":[
			   	{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
			   	{ "command":"var_to_var", "in":"tmpJson(resultError)", "out":"resultError" },
            	{ "command":"var_to_var", "in":"tmpJson(username)", "out":"username" },
            	{ "command":"var_to_var", "in":"tmpJson(password)", "out":"password" },
            	{ "command":"var_to_var", "in":"tmpJson(birthday)", "out":"birthday" },
            	{ "command":"var_to_var", "in":"tmpJson(name)", "out":"name" },
            	{ "command":"var_to_var", "in":"tmpJson(idcard)", "out":"idcard" },
				{ "command":"var_to_var", "out":"tmpJson" }
			]
		}
	],

	"add_email":[
		{
			"HttpMethod":"Post",
			"url":"http://103.37.164.146:9080/qmailadmin/index.cgi",
			"referer":"http://103.37.164.146:9080/qmailadmin/",
			"params":[
				{ "httpKey":"username", "default":"postmaster" },
				{ "httpKey":"domain", "default":"maopao.com" },
				{ "httpKey":"password", "default":"openet" },
				{ "httpKey":"returnhttp", "default":"" },
				{ "httpKey":"returntext", "default":"" }
			],
			"result_parserules":[
				{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
				{ "command":"regular_text", "in":"tmpString", "out":"timestamp", "regular":"(?<=time=).*?(?=\">)" },
				{ "command":"var_to_var", "out":"tmpString" }
			]
		},
		{
			"HttpMethod":"Get",
			"url":"http://103.37.164.146:9080/qmailadmin/index.cgi/com/adduser",
			"referer":"http://103.37.164.146:9080/qmailadmin/index.cgi",
			"params":[
				{ "httpKey":"user", "default":"postmaster" },
				{ "httpKey":"dom", "default":"maopao.com" },
				{ "httpKey":"time", "localKey":"timestamp" }
			],
			"result_parserules":[
					{ "command":"stream_gbk_to_utf8", "in":"_receiveData", "out":"_receiveData" },
					{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
					{ "command":"regular_text", "in":"tmpString", "out":"isLogined", "regular":"请稍后再登陆一次"},
					{ "command":"if", "if":["isLogined", ">", "@0", "length"], "rules":[
						{ "command":"var_to_var", "in":"@同时只能有一个人作为postmaster(邮箱管理员)登陆。已经有别人登陆进入。请稍后再登陆一次。", "out":"resultError" }
				     ]},
				    { "command":"var_to_var", "out":"isLogined" },
					{ "command":"var_to_var", "out":"tmpString" }
				]
		},
		{
			"HttpMethod":"Post",
			"url":"_url",
			"referer":"http://103.37.164.146:9080/qmailadmin/index.cgi/com/adduser",
			"input_parserules":[
				{ "command":"array_to_string", "in":["@http://103.37.164.146:9080/qmailadmin/index.cgi/com/addusernow?user=postmaster&dom=maopao.com&time=", "timestamp"], "out":"_url", "join":"" }
			],
			"params":[
				{ "httpKey":"newu", "localKey":"username" },
				{ "httpKey":"quota", "default":"1" },
				{ "httpKey":"password1", "default":"huoli123" },
				{ "httpKey":"password2", "default":"huoli123" },
				{ "httpKey":"gecos", "localKey":"username" }
			],
			"result_parserules":[
					{ "command":"stream_gbk_to_utf8", "in":"_receiveData", "out":"_receiveData" },
					{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
					{ "command":"regular_text", "in":"tmpString", "out":"isUsed", "regular":"名字已被使用"},
					{ "command":"if", "if":["isUsed", ">", "@0", "length"], "rules":[
						{ "command":"var_to_var", "in":"@该名字已被使用，请重新替换", "out":"resultError" }
				     ]},
					{ "command":"regular_text", "in":"tmpString", "out":"success", "regular":"添加成功"},
					{ "command":"if", "if":["success", ">", "@0", "length"], "rules":[
						{ "command":"var_to_var", "in":"@账户添加成功", "out":"successTip" },
						{ "command":"var_to_var", "in":"@add_success", "out":"action" }
					]},
					{ "command":"var_to_var", "out":"_url" },
					{ "command":"var_to_var", "out":"isUsed" },
					{ "command":"var_to_var", "out":"success" },
					{ "command":"var_to_var", "out":"tmpString" }
				]
		}
	],
	
	"register":[
		{
	    		"comment":"获取极验信息",
	    		"HttpMethod":"Get",
	    		"url":"https://i.ch.com/FindingLostPassword/initValidate",
	    		"waitTime":"2",
	    		"params":[
				],
				"result_parserules":[
					{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
					{ "command":"string_replace", "in":"tmpString", "out":"tmpString", "old":"\\", "new":"" },
					{ "command":"regular_text", "in":"tmpString", "out":"gt", "regular":"(?<=gt\":\").*?(?=\")" },
					{ "command":"regular_text", "in":"tmpString", "out":"challenge", "regular":"(?<=challenge\":\").*?(?=\")" },
					{ "command":"var_to_var", "out":"tmpString" }
				]
	    	},
	    	{
	    		"comment":"获取极验数据",
	            "HttpMethod":"Get",
				"url":"http://api.geetest.com/get.php",
				"referer":"https://i.ch.com/NonRegistrations/Regist",
				"params":[
					{ "httpKey":"gt", "localKey":"gt" },
					{ "httpKey":"challenge", "localKey":"challenge" },
					{ "httpKey":"product", "default":"embed" },
					{ "httpKey":"offline", "default":"false" },
					{ "httpKey":"callback", "localKey":"geetest_calllback" }
				],
				"result_parserules":[
					{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
					{ "command":"regular_text", "in":"tmpString", "out":"jsonString", "regular":"(?<=new Geetest\\().*?(?=,true\\))" },
					{ "command":"if", "if":["jsonString", "<", "@1"], "rules":[
						{ "command":"regular_text", "in":"tmpString", "out":"jsonString", "regular":"(?<=\\().*?(?=\\))" }
					]},
					
					{ "command":"string_to_json", "in":"jsonString", "out":"tmpJson" },
					{ "command":"var_to_var", "in":"tmpJson(gt)", "out":"gt" },
					{ "command":"var_to_var", "in":"tmpJson(challenge)", "out":"challenge" },
					{ "command":"var_to_var", "in":"tmpJson(slice)", "out":"slice" },
					{ "command":"var_to_var", "in":"tmpJson(bg)", "out":"bg" },
					{ "command":"var_to_var", "in":"tmpJson(fullbg)", "out":"fullbg" },
					
					{ "command":"var_to_var", "out":"tmpJson" },
					{ "command":"var_to_var", "out":"tmpString" },
					{ "command":"var_to_var", "out":"jsonString" }
				]
	    	},
	    	{
	    		"comment":"获取极验bg图片",
	            "HttpMethod":"Get",
				"url":"_url",
				"input_parserules":[
					{ "command":"array_to_string", "in":["@http://static.geetest.com/", "bg"], "out":"_url", "join":"" }
				],
				"result_parserules":[
					{ "command":"base64_encode", "in":"_receiveData", "out":"bgImage" }
				]
	    	},
	    	{
	    		"comment":"获取极验slice图片",
	            "HttpMethod":"Get",
				"url":"_url",
				"input_parserules":[
					{ "command":"array_to_string", "in":["@http://static.geetest.com/", "slice"], "out":"_url", "join":"" }
				],
				"result_parserules":[
					{ "command":"base64_encode", "in":"_receiveData", "out":"sliceImage" }
				]
	    	},
	    	{
	    		"comment":"获取极验fullbg图片",
	            "HttpMethod":"Get",
				"url":"_url",
				"input_parserules":[
					{ "command":"array_to_string", "in":["@http://static.geetest.com/", "fullbg"], "out":"_url", "join":"" }
				],
				"result_parserules":[
					{ "command":"base64_encode", "in":"_receiveData", "out":"fullBgImage" }
				]
	    	},
	    	{
	    		"comment":"极验识别",
	    		"HttpMethod":"Post",
	    		"url":"http://zhiji.rsscc.com/decaptcha/geetest/general/v1",
	    		"params":[
					{ "httpKey":"bgImage", "localKey":"bgImage" },
					{ "httpKey":"fullBgImage", "localKey":"fullBgImage" },
					{ "httpKey":"challenge", "localKey":"challenge" }
				],
				"result_parserules":[
					{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
					{ "command":"var_to_var", "in":"tmpJson(userresponse)", "out":"userresponse" },
					{ "command":"var_to_var", "in":"tmpJson(passtime)", "out":"passtime" },
					{ "command":"var_to_var", "in":"tmpJson(imgload)", "out":"imgload" },
					{ "command":"var_to_var", "in":"tmpJson(a)", "out":"a" },
					{ "command":"var_to_var", "in":"tmpJson(geetest_calllback)", "out":"geetest_calllback" }
				]
	    	},
	    	{
	    		"comment":"极验ajax验证",
	            "HttpMethod":"Get",
				"url":"http://api.geetest.com/ajax.php",
				"referer":"https://i.ch.com/NonRegistrations/Regist",
				"params":[
					{ "httpKey":"challenge", "localKey":"challenge" },
					{ "httpKey":"userresponse", "localKey":"userresponse" },
					{ "httpKey":"passtime", "localKey":"passtime" },
					{ "httpKey":"imgload", "localKey":"imgload" },
					{ "httpKey":"a", "localKey":"a" },
					{ "httpKey":"callback", "localKey":"geetest_calllback" }
				],
				"result_parserules":[
					{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
					{ "command":"regular_text", "in":"tmpString", "out":"tmpString", "regular":"(?<=\\().*?(?=\\))" },
					{ "command":"string_to_json", "in":"tmpString", "out":"tmpJson" },
					{ "command":"var_to_var", "in":"tmpJson(message)", "out":"message" },
					{ "command":"if", "if":["message", "=", "@success"], "rules":[
						{ "command":"var_to_var", "in":"tmpJson(validate)", "out":"geetest_validate" }
					], "else_rules":[
						{ "command":"var_to_var", "in":"message", "out":"resultError" }
					]},
					{ "command":"array_to_string", "in":["geetest_validate", "@jordan"], "out":"geetest_seccode", "join":"|" },
					{ "command":"var_to_var", "out":"bgImage" },
					{ "command":"var_to_var", "out":"sliceImage" },
					{ "command":"var_to_var", "out":"fullBgImage" },
					{ "command":"var_to_var", "out":"tmpJson" },
					{ "command":"var_to_var", "out":"tmpString" }
				]
	    	},
	    	
		   {
			"HttpMethod":"Post",
			"url":"https://i.ch.com/NonRegistrations/DoRegistSpringMember",
			"referer":"https://i.ch.com/NonRegistrations/Regist?email",
			"waitTime":"20",
			"input_parserules":[
				{ "command":"array_to_string", "in":["username", "@maopao.com"], "out":"login_username", "join":"@" }
			],
			"params":[
					{ "httpKey":"regType", "default":"2" },
					{ "httpKey":"member.BasicMemberInfo.BasicInfo.ChineseMobilePhoneNumber",  "default":"" },
					{ "httpKey":"member.BasicMemberInfo.BasicInfo.EmailAddress", "localKey":"login_username" },
					{ "httpKey":"geetest_challenge", "localKey":"challenge" },
					{ "httpKey":"geetest_validate", "localKey":"geetest_validate" },
					{ "httpKey":"geetest_seccode", "localKey":"geetest_seccode" },
					{ "httpKey":"member.BasicMemberInfo.BasicInfo.CheckCodes2",  "default":"" },
					{ "httpKey":"member.BasicMemberInfo.BasicInfo.EncodedPassword", "default":"Huoli123" },
					{ "httpKey":"member.BasicMemberInfo.BasicInfo.EncodedPassword1", "default":"Huoli123" },
					{ "httpKey":"member.BasicMemberInfo.BasicInfo.ChineseName", "localKey":"name" },
					{ "httpKey":"member.BasicMemberInfo.BasicInfo.GenderFlag", "localKey":"gender", "default":"0" },
					{ "httpKey":"member.BasicMemberInfo.BasicInfo.BirthDate", "localKey":"birthday" },
					{ "httpKey":"member.BasicMemberInfo.MoreInfo.Paper.TypeID", "localKey":"certType", "default":"1" },
					{ "httpKey":"member.BasicMemberInfo.MoreInfo.Paper.NO", "localKey":"idcard" },
					{ "httpKey":"member.BasicMemberInfo.BasicInfo.EmailAddress1",  "default":"" },
					{ "httpKey":"member.BasicMemberInfo.BasicInfo.TelPhoneNumber",  "default":"" },
					{ "httpKey":"member.BasicMemberInfo.MoreInfo.CountryName", "default":"中国" },
					{ "httpKey":"member.BasicMemberInfo.MoreInfo.ProvinceName",  "default":"" },
					{ "httpKey":"member.BasicMemberInfo.MoreInfo.CityName",  "default":"" },
					{ "httpKey":"member.BasicMemberInfo.MoreInfo.LivingAddress",  "default":"" },
					{ "httpKey":"member.BasicMemberInfo.MoreInfo.LivingAddressPostCode",  "default":"" },
					{ "httpKey":"subscribe", "default":"on" },
					{ "httpKey":"member.BasicMemberInfo.OtherInfo.CanAllowEmaillanguage[0]", "default":"1" },
					{ "httpKey":"Remark",  "default":"" },
					{ "httpKey":"cid",  "default":"" }
			],
			"result_parserules":[
					{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
					{ "command":"stream_to_string", "in":"_receiveData", "out":"resultJson" },
                	{ "command":"var_to_var", "in":"tmpJson(Code)", "out":"code" },
                	{ "command":"var_to_var", "in":"tmpJson(OtherInfo)", "out":"OtherInfo" },
                	{ "command":"if", "if":["OtherInfo", "<", "@9", "length"], "rules":[
                		{ "command":"var_to_var", "in":"code", "out":"resultError" }
						], "else_rules":[
					]}
				]
			}
	],

	"active":[
		   {
				"HttpMethod":"Post",
				"url":"http://103.37.164.146:9080/webmail/src/redirect.php",
				"referer":"http://103.37.164.146:9080/webmail/src/login.php",
				"ContentType":"application/x-www-form-urlencoded",
				"params":[
					{ "httpKey":"login_username", "localKey":"login_username" },
					{ "httpKey":"secretkey", "default":"huoli123" },
					{ "httpKey":"js_autodetect_results", "default":"1" },
					{ "httpKey":"just_logged_in", "default":"1" }
				],
				"result_parserules":[
						
					]
			},
			{
				"HttpMethod":"Get",
				"url":"http://103.37.164.146:9080/webmail/src/right_main.php",
				"referer":"http://103.37.164.146:9080/webmail/src/webmail.php",
				"params":[
				],
				"result_parserules":[
					{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
					{ "command":"regular_text", "in":"tmpString", "out":"passed_id", "regular":"(?<=INBOX&amp;passed_id=).*?(?=&amp;startMessage=1\" >&#35831;&#28608;&#27963;&#24744;&#30340;)" },
					{ "command":"if", "if":["passed_id", "=", "@0", "length"], "rules":[
						{ "command":"var_to_var", "in":"@找不到激活的邮件", "out":"resultError" }
			    	 ]},
					{ "command":"var_to_var", "out":"tmpString" }
				]
			},
			{
				"HttpMethod":"Get",
				"url":"http://103.37.164.146:9080/webmail/src/read_body.php",
				"referer":"http://103.37.164.146:9080/webmail/src/webmail.php",
				"params":[
					{ "httpKey":"mailbox","default":"INBOX"},
					{ "httpKey":"passed_id","localKey":"passed_id"},
					{ "httpKey":"startMessage","default":"1"}
				],
				"result_parserules":[
					{ "command":"stream_to_string", "in":"_receiveData", "out":"tmpString" },
					{ "command":"regular_text", "in":"tmpString", "out":"postmasterUrl", "regular":"(?<=http://postmaster.springairlines.com/).*?(?=\" )" },
					{ "command":"if", "if":["postmasterUrl", "=", "@0", "length"], "rules":[
						{ "command":"var_to_var", "in":"@找不到激活的邮件", "out":"resultError" }
		    		 ], "else_rules":[
		    			{ "command":"array_to_string", "in":["@http://postmaster.springairlines.com/", "postmasterUrl"], "out":"postmasterUrl", "join":"" }
					]},
					{ "command":"var_to_var", "out":"tmpString" }
				]
			},
			{
				"HttpMethod":"Get",
				"url":"_url",
				"input_parserules":[
					{ "command":"var_to_var", "in":"postmasterUrl", "out":"_url" }
				],
				"params":[
					],
				"result_parserules":[
						{ "command":"stream_to_string", "in":"_receiveData", "out":"page" }
					]
			},
			{
				"HttpMethod":"Post",
				"url":"http://zhiji.rsscc.com/flight_helper/9c/booking/getActiveUrlFromMaopao.json",
				"params":[
					{ "httpKey":"page","localKey":"page"}
				],
				"result_parserules":[
				   	{ "command":"stream_to_json", "in":"_receiveData", "out":"tmpJson" },
				   	{ "command":"var_to_var", "in":"tmpJson(resultError)", "out":"resultError" },
		        	{ "command":"var_to_var", "in":"tmpJson(activeUrl)", "out":"activeUrl" },
					{ "command":"if", "if":["activeUrl", "=", "@0", "length"], "rules":[
						{ "command":"var_to_var", "in":"@找不到激活的邮件", "out":"resultError" }
			    	 ]},
					{ "command":"var_to_var", "out":"page" }
				]
			},
			{
				"HttpMethod":"Get",
				"url":"_url",
				"input_parserules":[
					{ "command":"var_to_var", "in":"activeUrl", "out":"_url" }
				],
				"params":[
				],
				"result_parserules":[
						{ "command":"stream_to_string", "in":"_receiveData", "out":"page" },
						{ "command":"regular_text", "in":"page", "out":"actived", "regular":"用户已激活"},
						{ "command":"regular_text", "in":"page", "out":"successActived", "regular":"您已经成功激活"},
						{ "command":"if", "if":["actived", ">", "@0", "length"], "rules":[
							{ "command":"var_to_var", "in":"@激活成功", "out":"desc" },
							{ "command":"var_to_var", "in":"@1", "out":"code" }
					     ]},
					     { "command":"if", "if":["successActived", ">", "@0", "length"], "rules":[
							{ "command":"var_to_var", "in":"@激活成功", "out":"desc" },
							{ "command":"var_to_var", "in":"@1", "out":"code" }
					     ]}
					]
			}
	  ]
	},
	
	"settings":{
		"exclude_from_local_dict":[
			"_receiveData",
			"page",
			"content",
			"verifyCodeImage"
		],
		
		"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36 OPR/28.0.1750.51"
    }
}